---
name: refactor
description: コードのリファクタリングを行う。リファクタ、整理、クリーンアップ、構造改善、コード品質向上時に使用
---

# Refactoring Skill

コードの動作を変えずに、構造・可読性・保守性を改善するためのスキル。

## 基本原則

1. **動作を保持する** - リファクタリング前後でテストが通ること
2. **小さなステップで進める** - 一度に大きな変更をしない
3. **変更前にテストを確認** - 既存テストがあるか、なければ追加を検討

## リファクタリング手順

### Step 1: 現状分析

対象コードを読み、以下を確認:

- 関数/モジュールの責務は明確か
- 重複コードはないか
- 命名は適切か
- 複雑度は高くないか

### Step 2: 計画

改善点をリストアップし、優先順位をつける:

1. 明らかなコードスメル（重複、長い関数など）
2. 命名の改善
3. 構造の改善

### Step 3: 実行

各変更後に確認:

```bash
cargo check   # コンパイル確認
cargo test    # テスト実行
cargo clippy  # lint確認
```

### Step 4: フォーマット

```bash
cargo fmt
```

## よくあるリファクタリングパターン

### 関数の抽出

長い関数を小さな関数に分割

### 変数/関数のリネーム

意図が伝わる名前に変更

### 重複の排除

共通処理を関数化

### 条件分岐の簡略化

ネストを減らす、早期リターンを使う

### モジュール分割

大きなファイルを責務ごとに分割

## Rustプロジェクト固有の考慮点

- `pub`の範囲を最小限に
- `impl`ブロックの整理
- エラー処理の統一（`Result`/`Option`の活用）
- 不要な`clone()`の削除
- ライフタイムの簡略化

## 注意事項

- 機能追加とリファクタリングは別コミットにする
- 破壊的変更が必要な場合は事前に確認する
- パフォーマンスに影響する変更は計測してから行う
